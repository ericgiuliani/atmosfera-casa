<div id="wf-form-container-387"></div>
<script>
    (function () {
        var container = document.createElement("div");
        container.className = "container";
        container.style.maxWidth = "500px";
        container.style.display = "none";
        var css = [
            "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta.3/css/bootstrap.min.css",
            "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css",
            "https://use.fontawesome.com/releases/v5.0.13/css/all.css",
            "https://css.affiliatenetwork.link/manager/SBAdmin/css/form.css",
            "https://css.affiliatenetwork.link/manager/SBAdmin/css/lightbox.min.css",
        ];
        css.forEach(function (url) {
            var link = document.createElement("link");
            link.rel = "stylesheet";
            link.href = url;
            document.head.appendChild(link);
        });
        var html = '<center><h3 class="title">COMPILA IL MODULO</h3></center>';
        html +=
            '<form method="post" accept-charset="utf-8" role="form" id="wf_form_72846" action="/manager/inventory/get_form/kalai_magicbread_2x1/387?ref=042551811c82&amp;small=1"><div style="display:none;"><input type="hidden" name="_method" value="POST"/></div>';
        html += '<input type="hidden" name="fingerprint" id="fingerprint" value="">';
        html += '<input type="hidden" name="aff_sub1" value="">';
        html +=
            '<input type="hidden" name="source_id" id="source_id" value="042551811c82"><input type="hidden" name="city" value="-"><input type="hidden" name="zipcode" value="00000"><input type="hidden" name="notes" value=" "><div class="form-group"><label>Nome e Cognome</label><input type="text" name="name" class="form-control" placeholder="Inserisci Nome e Cognome" required="required"/></div><div class="form-group"><label>Telefono (Meglio Cellulare)</label><input type="text" name="phone" class="form-control" placeholder="Inserisci il tuo numero di telefono" required="required" value=""/></div><div class="form-group"><label>Indirizzo e n. civico</label><input type="text" name="address" class="form-control" placeholder="ES. Via Aldo moro, 130" required="required" value=""/></div><div class="form-row offer-selection" data-images=\'[]\' data-default-img=\'https://manager-uploads.s3.eu-central-1.amazonaws.com/upload/products/image/2891_9bd46a7a62c53ed6fc22c5b0934d5656_1703232996.jpg\'><div class="col-auto text-center d-flex align-items-center" data-toggle="lightbox"><img data-jslghtbx style="max-width:100%;max-height:80px;" src="https://manager-uploads.s3.eu-central-1.amazonaws.com/upload/products/image/2891_9bd46a7a62c53ed6fc22c5b0934d5656_1703232996.jpg"></div><div class="form-group col text-center"><span>Offerta attiva:</span><h5>2 Magic Bread 59,99 €</h5><select name="quantity" class="d-none" required="required"><option value="2">2 Magic Bread 59,99 €</option></select></div></div>';
        html +=
            '<center><div id="info-privacy"><small>Cliccando "Completa l\'acquisto" confermi di aver preso visione <a href="/landing/privacy.html" target="_blank">dell\'informativa sulla privacy</a>.</small></div><button id="submit-button" class="btn btn-lg btn-warning new-sbm-btn" type="submit">Completa l\'acquisto</button></center>';
        html += "</form>";
        container.innerHTML = html;
        document.querySelector("#wf-form-container-387").appendChild(container);
        document.querySelector("#wf-form-container-387").removeAttribute("id");
        var form = document.querySelector("#wf_form_72846");
        form.addEventListener("submit", function (e) {
            e.preventDefault();
            var form = this;
            form.classList.add("loading");
            if (form.dataset.submitted) {
                console.log("submit blocked");
                return;
            } else form.dataset.submitted = true;
            var data = new FormData(form);
            var req = new XMLHttpRequest();
            req.open("POST", atob("aHR0cHM6Ly9pZnJhbWUuYWZmaWxpYXRlbmV0d29yay5saW5rL21hbmFnZXIvaW52ZW50b3J5L2J1eS9rYWxhaV9tYWdpY2JyZWFkXzJ4MS5qc29u"), false);
            req.onreadystatechange = function (a, b, c) {
                form = document.querySelector("#wf_form_72846");
                form.classList.remove("loading");
                if (this.status == 200) {
                    var resp = this.response;
                    var data = JSON.parse(resp);
                    if (data.status === "success") location.href = data.thankyou_url;
                    else {
                        var errors = data.errors;
                        if (Object.keys(errors).length > 0) {
                            last_error_element = false;
                            for (var key in errors) {
                                error = errors[key];
                                for (var k in error) {
                                    message = error[k];
                                    break;
                                }
                                if (form.querySelectorAll("[name=" + key + "]").length > 0) {
                                    form_element = form.querySelector("[name=" + key + "]");
                                    form_group = form_element.closest(".form-group");
                                    if (form_group.querySelector(".invalid-feedback") === null) {
                                        form_group.innerHTML += '<div class="invalid-feedback"></div>';
                                    }
                                    form_group.querySelector(".invalid-feedback").innerText = message;
                                    form_element = form.querySelector("[name=" + key + "]");
                                    form_element.classList.add("is-invalid");
                                    last_error_element = form_element;
                                } else if (typeof message === "string") {
                                    alert(message);
                                } else console.log(message);
                            }
                            if (last_error_element) last_error_element.scrollIntoView({ behavior: "smooth" });
                            document.querySelectorAll(".is-invalid").forEach(function (el) {
                                el.addEventListener("change", function (e) {
                                    this.classList.remove("is-invalid");
                                });
                            });
                        }
                    }
                } else {
                    console.log("error");
                }
            };
            req.send(data);
        });
        function wfMultipleOptions() {
            var form = document.querySelector("#wf_form_72846");
            var field = form.querySelector("[name=quantity]");
            val = parseInt(field.value);
            if (form.querySelectorAll(".extra_multiple_options").length > 0) {
                elements = form.querySelectorAll(".extra_multiple_options.first-element");
                document.querySelectorAll(".extra_multiple_options:not(.first-element)").forEach(function (elem) {
                    elem.parentNode.removeChild(elem);
                });
                elements.forEach(function (el) {
                    appendnext = el;
                    for (var i = 1; i <= val - 1; i++) {
                        newel = el.cloneNode(true);
                        newel.classList.remove("first-element");
                        appendnext.after(newel);
                        count = newel.querySelector(".extra_multiple_count");
                        newel.querySelector(".extra_multiple_count").innerHTML = i + 1;
                        appendnext = newel;
                    }
                });
            }
            var parent = field.closest(".offer-selection");
            var images = JSON.parse(parent.dataset.images);
            var value = field.value;
            if (images[value]) parent.querySelector("img").setAttribute("src", images[value]);
            else parent.querySelector("img").setAttribute("src", parent.dataset.defaultImg);
        }
        form = document.querySelector("#wf_form_72846");
        form.querySelector("[name=quantity]").addEventListener("change", wfMultipleOptions);
        setTimeout(function () {
            wfMultipleOptions();
            container.style.display = "block";
            form.querySelectorAll("[name^=extra_options]").forEach(function (element) {
                element.dispatchEvent(new Event("change", { bubbles: true }));
            });
        }, 100);
        document.body.addEventListener("change", function (e) {
            if (e.target.parentNode.querySelectorAll("[name^=extra_options]").length > 0) {
                el = e.target.parentNode.querySelector("[name^=extra_options]");
                var parent = el.closest(".extra_multiple_options");
                var images = JSON.parse(parent.dataset.images);
                var value = el.value;
                if (images[value]) {
                    parent.querySelector(".multiple-option-img").classList.remove("force-hidden");
                    parent.querySelector(".multiple-option-img img").setAttribute("src", images[value]);
                } else parent.querySelector(".multiple-option-img").classList.add("force-hidden");
            }
        });
        script = document.createElement("script");
        script.onload = function () {
            var lightbox = new Lightbox();
            lightbox.load();
        };
        script.src = "https://iframe.affiliatenetwork.link/manager/SBAdmin/js/lightbox.min.js";
        document.head.appendChild(script);
        if (typeof Fingerprint2 !== "function") {
            script = document.createElement("script");
            script.onload = function () {
                new Fingerprint2().get(function (result, components) {
                    if (result) document.querySelector("#wf_form_72846 #fingerprint").value = result;
                });
            };
            script.src = "https://cdnjs.cloudflare.com/ajax/libs/fingerprintjs2/1.5.1/fingerprint2.min.js";
            document.head.appendChild(script);
        } else {
            new Fingerprint2().get(function (result, components) {
                if (result) document.querySelector("#wf_form_72846 #fingerprint").value = result;
            });
        }
    })();
</script>
